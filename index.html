<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Dual Pro - Ultimate</title>
    <style>
        :root {
            --bg: #121212; --panel: #2d2d2d; --accent: #f2a154; 
            --blue: #5183b4; --green: #539d67; --text: #ffffff;
            --btn-std: #d1d1d1; --btn-sci: #4a4a4a;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #000; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .calculator { background: var(--panel); width: 440px; border-radius: 12px; overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.6); }
        
        /* PANTALLA */
        #std-display { background: #222; height: 110px; display: flex; flex-direction: column; align-items: flex-end; justify-content: center; padding: 0 25px; border-bottom: 2px solid #111; }
        .info-bar { width: 100%; display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--accent); font-weight: bold; margin-bottom: 5px; }
        #main-val { font-size: 2.5rem; color: white; white-space: nowrap; overflow: hidden; }

        /* TABS Y PANTALLAS PROG */
        .tabs { display: flex; background: #333; }
        .tab { flex: 1; padding: 14px; border: none; background: transparent; color: #888; cursor: pointer; font-weight: bold; font-size: 0.8rem; }
        .tab.active { color: var(--accent); background: var(--panel); }
        .prog-screens { display: none; flex-direction: column; border-bottom: 1px solid #444; }
        .base-row { display: flex; padding: 6px 15px; justify-content: space-between; align-items: center; }
        .base-label { font-weight: bold; width: 50px; font-size: 0.75rem; color: #aaa; }
        .base-val { font-family: 'Courier New', monospace; font-size: 1rem; color: #eee; }

        /* REJILLA */
        .main-layout { display: flex; background: #444; gap: 1px; }
        .hex-sidebar { display: none; flex-direction: column; width: 70px; gap: 1px; }
        .num-pad { flex: 1; display: grid; grid-template-columns: repeat(4, 1fr) 1.1fr; gap: 1px; }
        button { border: none; background: var(--btn-std); color: #000; padding: 18px 5px; font-size: 1.1rem; cursor: pointer; font-weight: 600; }
        button:hover { filter: brightness(1.1); }
        .btn-op { background: var(--blue); color: white; font-size: 1.4rem; }
        .btn-orange { background: var(--accent); color: white; }
        .btn-sci { background: var(--btn-sci); color: white; font-size: 0.85rem; }
        .btn-hex { background: #555; color: white; flex: 1; }
        .btn-equal { grid-row: span 2; background: var(--accent); color: white; }
        
        .prog-active .hex-sidebar { display: flex; }
        .prog-active .prog-screens { display: flex; }
        .unit-badge { background: #444; padding: 2px 6px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div class="calculator" id="calc">
    <div class="tabs">
        <button class="tab active" id="t-std" onclick="setMode('std')">ESTÁNDAR</button>
        <button class="tab" id="t-prog" onclick="setMode('prog')">PROGRAMADOR</button>
    </div>

    <div class="prog-screens">
        <div class="base-row"><span class="base-label">HEX</span><span id="h-v" class="base-val">0</span></div>
        <div class="base-row"><span class="base-label">DEC</span><span id="d-v" class="base-val">0</span></div>
        <div class="base-row"><span class="base-label">BIN</span><span id="b-v" class="base-val">0000 0000</span></div>
    </div>

    <div id="std-display">
        <div class="info-bar">
            <span id="mem-inc"></span>
            <span class="unit-badge" onclick="toggleUnits()" id="unit-btn">DEG</span>
        </div>
        <div id="main-val">0</div>
    </div>

    <div class="main-layout">
        <div class="hex-sidebar">
            <button class="btn-hex" onclick="add('A')">A</button>
            <button class="btn-hex" onclick="add('B')">B</button>
            <button class="btn-hex" onclick="add('C')">C</button>
            <button class="btn-hex" onclick="add('D')">D</button>
            <button class="btn-hex" onclick="add('E')">E</button>
            <button class="btn-hex" onclick="add('F')">F</button>
        </div>

        <div class="num-pad">
            <button class="btn-sci" onclick="add('sin(')">sin</button>
            <button class="btn-sci" onclick="add('cos(')">cos</button>
            <button class="btn-sci" onclick="add('(')">(</button>
            <button class="btn-sci" onclick="add(')')">)</button>
            <button class="btn-orange" onclick="clearAll()">AC</button>

            <button class="btn-sci" onclick="add('log(')">ln</button>
            <button class="btn-sci" onclick="add('log10(')">log</button>
            <button class="btn-sci" onclick="memOp('MR')">MR</button>
            <button class="btn-orange" onclick="del()">DEL</button>
            <button class="btn-op" onclick="add('/')">÷</button>

            <button onclick="add('7')">7</button>
            <button onclick="add('8')">8</button>
            <button onclick="add('9')">9</button>
            <button class="btn-sci" onclick="memOp('M+')">M+</button>
            <button class="btn-op" onclick="add('*')">×</button>

            <button onclick="add('4')">4</button>
            <button onclick="add('5')">5</button>
            <button onclick="add('6')">6</button>
            <button class="btn-sci" onclick="memOp('M-')">M-</button>
            <button class="btn-op" onclick="add('-')">−</button>

            <button onclick="add('1')">1</button>
            <button onclick="add('2')">2</button>
            <button onclick="add('3')">3</button>
            <button class="btn-sci" onclick="add('π')">π</button>
            <button class="btn-op" onclick="add('+')">+</button>

            <button onclick="add('0')" style="grid-column: span 2;">0</button>
            <button onclick="add('.')">.</button>
            <button class="btn-sci" onclick="memOp('MC')">MC</button>
            <button class="btn-equal" onclick="solve()">=</button>
        </div>
    </div>
</div>

<script>
    let val = "0";
    let memory = 0;
    let isProg = false;
    let angleMode = 'DEG'; // 'DEG' o 'RAD'

    function toggleUnits() {
        angleMode = (angleMode === 'DEG') ? 'RAD' : 'DEG';
        document.getElementById('unit-btn').innerText = angleMode;
    }

    function setMode(m) {
        isProg = (m === 'prog');
        document.getElementById('calc').className = isProg ? 'calculator prog-active' : 'calculator';
        document.getElementById('t-std').classList.toggle('active', !isProg);
        document.getElementById('t-prog').classList.toggle('active', isProg);
        update();
    }

    function add(v) {
        let lastChar = val.slice(-1);
        // Multiplicación implícita para Pi y funciones: 2π -> 2*π
        if (!isNaN(lastChar) && (v === 'π' || v.includes('('))) {
            val += '*';
        }
        if (val === "0" && v !== '.' && v !== 'π' && !v.includes('(')) val = v;
        else val += v;
        update();
    }

    function clearAll() { val = "0"; update(); }
    function del() { val = val.length > 1 ? val.slice(0, -1) : "0"; update(); }

    function memOp(op) {
        try {
            let current = eval(preprocess(val)) || 0;
            if (op === 'MC') memory = 0;
            if (op === 'MR') val = memory.toString();
            if (op === 'M+') memory += current;
            if (op === 'M-') memory -= current;
            document.getElementById('mem-inc').innerText = memory !== 0 ? "M" : "";
            update();
        } catch(e) { alert("Error en memoria"); }
    }

    function preprocess(exp) {
        let res = exp.replace(/π/g, 'Math.PI')
                     .replace(/×/g, '*').replace(/÷/g, '/')
                     .replace(/log10\(/g, 'Math.log10(')
                     .replace(/log\(/g, 'Math.log(');
        
        // Manejo de DEG/RAD para sin y cos
        if (angleMode === 'DEG') {
            res = res.replace(/sin\(/g, 'Math.sin((Math.PI/180)*')
                     .replace(/cos\(/g, 'Math.cos((Math.PI/180)*');
        } else {
            res = res.replace(/sin\(/g, 'Math.sin(')
                     .replace(/cos\(/g, 'Math.cos(');
        }
        return res;
    }

    function update() {
        document.getElementById('main-val').innerText = val;
        if(isProg) {
            let n = parseInt(val.match(/\d+/g)?.pop() || 0, 10);
            document.getElementById('h-v').innerText = n.toString(16).toUpperCase();
            document.getElementById('d-v').innerText = n.toString(10);
            document.getElementById('b-v').innerText = n.toString(2).padStart(8, '0').replace(/(.{4})/g, '$1 ');
        }
    }

    function solve() {
        try {
            let tempVal = val;
            let openP = (tempVal.match(/\(/g) || []).length;
            let closeP = (tempVal.match(/\)/g) || []).length;
            while(openP > closeP) { tempVal += ')'; closeP++; }

            let result = eval(preprocess(tempVal));
            val = Number(result.toPrecision(10)).toString();
            update();
        } catch {
            val = "Error"; update(); setTimeout(clearAll, 1000);
        }
    }
</script>
</body>
</html>
